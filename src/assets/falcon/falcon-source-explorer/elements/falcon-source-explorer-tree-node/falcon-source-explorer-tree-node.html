<link rel="import" href="./../../../../bower_components/polymer/polymer.html" />
<link rel="import" href="./../../../../bower_components/iron-icons/iron-icons.html" />
<link rel="import" href="./../../../../bower_components/iron-icon/iron-icon.html" />
<link rel="import" href="./../../../../bower_components/paper-menu-button/paper-menu-button.html" />
<link rel="import" href="./../../../../bower_components/paper-listbox/paper-listbox.html" />
<link rel="import" href="./../../../../bower_components/paper-item/paper-item.html" />
<link rel="import" href="./../../../../bower_components/paper-button/paper-button.html" />

<link rel="import" href="./../../../falcon-polymer-utils/falcon-polymer-utils.html" />
<link rel="import" href="./../../behaviors/falcon-source-explorer-utils/falcon-source-explorer-utils.html" />
<link rel="import" href="./../../mixins/generic-tree/generic-tree.html" />
<link rel="import" href="./../../classes/drag-helper/drag-helper.html" />

<dom-module id="falcon-source-explorer-tree-node">
  <template>
    <style>
      :host {
        display: block;
        width: 100%;
        font-size: var(--falcon-source-explorer-font-size, 15px);
        cursor: pointer;
      }

      :host(.drag-over) > .falcon-source-explorer-tree-node-container > .falcon-source-explorer-tree-node-row {
        background-color: rgb(160, 214, 255);
      }

      .falcon-source-explorer-tree-node-container {
        white-space: nowrap;
      }

      .falcon-source-explorer-tree-node-preicon:before {
        margin-right: 5px;
      }

      .falcon-source-explorer-tree-node-preicon.collapsed:before {
        content: '\002B';
      }
      .falcon-source-explorer-tree-node-preicon.expanded:before {
        content: '\2212';
      }

      .falcon-source-explorer-tree-node-collapsed {
        color: var(--falcon-source-explorer-tree-node-collapsed-color, rgb(0, 0, 0));
      }

      .falcon-source-explorer-tree-node-expanded {
        color: var(--falcon-source-explorer-tree-node-expanded-color, rgb(0, 0, 0));
      }

      .falcon-source-explorer-tree-node-opened {
        color: var(--falcon-source-explorer-tree-node-opened-color, rgb(0, 0, 0));
      }

      .falcon-source-explorer-tree-node-closed {
        color: var(--falcon-source-explorer-tree-node-closed-color, rgb(0, 0, 0));
      }

      .falcon-source-explorer-tree-node-disabled {
        color: var(--falcon-source-explorer-tree-node-disabled-color, rgb(0, 0, 0));
        cursor: not-allowed;
      }

      .falcon-source-explorer-tree-node-row {
        position: relative;
      }

      .falcon-source-explorer-tree-node-row > div {
        overflow: hidden;
        padding-right: 20px;
        text-overflow: ellipsis;
      }

      .falcon-source-explorer-tree-node-selected {
        background-color: rgba(200, 200, 200, 0.5);
        color: inherit;
      }

      .falcon-source-explorer-tree-node-actions-icon {
        height: 100%;
        position: absolute;
        right: 0;
      }

      .falcon-source-explorer-tree-node-actions-dropdown-item {
        --paper-font-subhead_-_font-size: --falcon-source-explorer-font-size;
        --paper-font-subhead_-_line-height: 35px;
        --paper-item-min-height: 35px;
        --paper-item-selected-weight: 400;
        background-color: var(--falcon-source-explorer-tree-node-selected-background-color, rgba(200, 200, 200, 0.5));
        display: block;
        text-align: center;
      }

      .falcon-source-explorer-tree-node-actions-dropdown {
        padding: 0;
        position: absolute;
        right: 0;
        z-index: 1;
      }

      .falcon-source-explorer-tree-node-ul {
        margin: 0;
        padding-left: 25px;
      }

      .falcon-source-explorer-tree-node-li {
        list-style-type: none;
        margin-left: 0px;
      }

      .small-toggle-size {
        font-size: 0.6em;
      }
    </style>

    <div class="falcon-source-explorer-tree-node-container">
      <div class="falcon-source-explorer-tree-node-row">
        <div class$="[[_computeSelected(data.*)]]">
          <span class$="[[_computeColor(data.*)]]">
            <!-- Expandable. -->
            <template is="dom-if" if="[[data.expandable]]">
              <template is="dom-if" if="[[data.expanded]]">
                <span id$="falcon-source-explorer-tree-node-expandable-[[data.id]]" class="falcon-source-explorer-tree-node-preicon expanded" on-click="_collapse"></span>
              </template>

              <template is="dom-if" if="[[!data.expanded]]">
                <span id$="falcon-source-explorer-tree-node-expandable-[[data.id]]" class="falcon-source-explorer-tree-node-preicon collapsed" on-click="_expand"></span>
              </template>
            </template>

            <!-- Openable. -->
            <template is="dom-if" if="[[data.openable]]">
              <template is="dom-if" if="[[data.opened]]">
                <span id$="falcon-source-explorer-tree-node-openable-[[data.id]]" class="falcon-source-explorer-tree-node-preicon small-toggle-size fa fa-toggle-on" on-click="_close"></span>
              </template>

              <template is="dom-if" if="[[!data.opened]]">
                <span id$="falcon-source-explorer-tree-node-openable-[[data.id]]" class="falcon-source-explorer-tree-node-preicon small-toggle-size fa fa-toggle-off" on-click="_open"></span>
              </template>
            </template>

            <span on-click="_select">
              <!-- Icon. -->
              <span class="falcon-source-explorer-tree-node-icon">
                <i class$="[[data.icon]]" aria-hidden="true"></i>
              </span>

              <span id$="falcon-source-explorer-tree-node-name-[[data.id]]">[[data.name]]</span>
            </span>
          </span>

          <!-- Dropdown Icon. -->
          <template is="dom-if" if="[[_computeShowMenu(data.*)]]">
            <template is="dom-if" if="[[!_dropdownExpanded]]">
              <iron-icon icon="icons:more-vert" class="falcon-source-explorer-tree-node-actions-icon" on-click="_openDropdown"></iron-icon>
            </template>
          </template>

        </div>
        <template is="dom-if" if="[[_dropdownExpanded]]">
          <!-- Dropdown. -->
          <paper-listbox class="falcon-source-explorer-tree-node-actions-dropdown" slot="dropdown-content">
              <template is="dom-repeat" items="[[globalActions]]" as="action">
                <paper-item class="falcon-source-explorer-tree-node-actions-dropdown-item" on-click="_action">[[action.name]]</paper-item>
              </template>

              <template is="dom-if" if="[[data.actions]]">
                <template is="dom-repeat" items="[[data.actions]]" as="action">
                  <paper-item class="falcon-source-explorer-tree-node-actions-dropdown-item" on-click="_action">[[action.name]]</paper-item>
                </template>
              </template>

              <template is="dom-if" if="[[data.pinnable]]">
                <template is="dom-if" if="[[!data.pinned]]">
                  <paper-item class="falcon-source-explorer-tree-node-actions-dropdown-item" on-click="_pin">Pin</paper-item>
                </template>

                <template is="dom-if" if="[[data.pinned]]">
                  <paper-item class="falcon-source-explorer-tree-node-actions-dropdown-item" on-click="_unpin">Unpin</paper-item>
                </template>
              </template>
            </paper-listbox>
        </template>
      </div>

      <template is="dom-if" if="[[data.expanded]]">
        <ul class="falcon-source-explorer-tree-node-ul">
          <template is="dom-repeat" items="[[getDataChildren(data.*)]]" filter="[[_filter(searchTerm)]]">
            <li class="falcon-source-explorer-tree-node-li">
              <falcon-source-explorer-tree-node
                children-key="[[childrenKey]]"
                draggable$="[[_stringifyBool(item.draggable)]]"
                data="[[item]]"
                global-actions="[[globalActions]]"
                id$="falcon-source-explorer-tree-node-[[item.id]]"
                search-term="[[searchTerm]]"
              >
              </falcon-source-explorer-tree-node>
            </li>
          </template>
        </ul>
      </template>
    </div>
  </template>

  <script src="./falcon-source-explorer-tree-node.js"></script>
</dom-module>
