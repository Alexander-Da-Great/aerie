<!doctype html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>falcon-source-explorer-tree-node test</title>

    <script>
      // ShadyDOM re-writes getElementById and querySelector.
      // Grab native versions here before they are replaced.
      document.getElementByIdNative = document.getElementById;
      document.querySelectorNative = document.querySelector;
    </script>

    <script>window.ShadyDOM = { force: true };</script>
    <script src="./../../../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
    <script src="./../../../bower_components/web-component-tester/browser.js"></script>

    <link rel="import" href="./../elements/falcon-source-explorer/falcon-source-explorer.html" />
  </head>

  <body>
    <test-fixture id="FalconSourceExplorer">
      <template>
        <falcon-source-explorer
          data='{"id":"0","name":"root","children":[{"actions":[],"draggable":false,"expandable":true,"expanded":false,"icon":"fa fa-database","id":"1","menu":true,"name":"Documents","openable":false,"opened":false,"parentId":"0","pinnable":false,"pinned":false,"selectable":true,"selected":false,"children":[{"draggable":true,"expandable":true,"expanded":true,"icon":"fa fa-folder","id":"3","menu":true,"name":"Pictures","openable":false,"opened":false,"parentId":"1","pinnable":true,"pinned":false,"selectable":true,"selected":false,"children":[{"draggable":true,"expandable":true,"expanded":true,"icon":"fa fa-folder","id":"5","menu":true,"name":"More Pictures","openable":false,"opened":false,"parentId":"3","pinnable":true,"pinned":false,"selectable":true,"selected":false,"children":[{"draggable":true,"expandable":false,"expanded":false,"icon":"fa fa-file-o","id":"9","menu":false,"name":"helloWorld.jpg","openable":true,"opened":false,"parentId":"5","pinnable":false,"pinned":false,"selectable":false,"selected":false}]},{"draggable":true,"expandable":false,"expanded":false,"icon":"fa fa-file-o","id":"6","menu":false,"name":"smile.jpg","openable":true,"opened":false,"parentId":"3","pinnable":false,"pinned":false,"selectable":false,"selected":false},{"draggable":true,"expandable":false,"expanded":false,"icon":"fa fa-file-o","id":"7","menu":false,"name":"frown.png","openable":true,"opened":false,"parentId":"3","pinnable":false,"pinned":false,"selectable":false,"selected":false},{"draggable":true,"expandable":false,"expanded":false,"icon":"fa fa-file-o","id":"8","menu":false,"name":"docile.jpg","openable":true,"opened":false,"parentId":"3","pinnable":false,"pinned":false,"selectable":false,"selected":false}]}]},{"draggable":false,"expandable":true,"expanded":true,"icon":"fa fa-database","id":"2","menu":true,"name":"Downloads","openable":false,"opened":false,"parentId":"0","pinnable":false,"pinned":false,"selectable":true,"selected":false,"children":[{"draggable":true,"expandable":false,"expanded":false,"icon":"fa fa-file-o","id":"4","menu":false,"name":"index.html","openable":true,"opened":false,"parentId":"2","pinnable":false,"pinned":false,"selectable":false,"selected":false},{"draggable":true,"expandable":false,"expanded":false,"icon":"fa fa-file-o","id":"10","menu":false,"name":"text.html","openable":true,"opened":true,"parentId":"2","pinnable":false,"pinned":false,"selectable":false,"selected":false}]}]}'
          global-actions='[{"name":"Get Info","event":"get-info"},{"name":"Delete","event":"delete"}]'
        >
        </falcon-source-explorer>
      </template>
    </test-fixture>

    <script>
      describe('falcon-source-explorer-tree-node', function() {
        let falconSourceExplorer;

        beforeEach(() => {
          falconSourceExplorer = fixture('FalconSourceExplorer');
        });

        it('should catch _expand', function(done) {
          flush(function() {
            falconSourceExplorer.addEventListener('expand-falcon-source-explorer-tree-node', (e) => {
              expect(e.detail.data.expanded).to.equal(true);
              done();
            });

            const node = document.getElementByIdNative('falcon-source-explorer-tree-node-1');
            toggle = document.getElementByIdNative('falcon-source-explorer-tree-node-expandable-1');

            expect(node.data.expanded).to.equal(false);
            toggle.click();
          });
        });

        it('should catch _collapse', function(done) {
          flush(function() {
            falconSourceExplorer.addEventListener('collapse-falcon-source-explorer-tree-node', (e) => {
              expect(e.detail.data.expanded).to.equal(false);
              done();
            });

            const node = document.getElementByIdNative('falcon-source-explorer-tree-node-2');
            toggle = document.getElementByIdNative('falcon-source-explorer-tree-node-expandable-2');

            expect(node.data.expanded).to.equal(true);
            toggle.click();
          });
        });

        it('should catch _close', function(done) {
          flush(function() {
            falconSourceExplorer.addEventListener('close-falcon-source-explorer-tree-node', (e) => {
              expect(e.detail.data.opened).to.equal(false);
              done();
            });

            const child = document.getElementByIdNative('falcon-source-explorer-tree-node-10');
            toggle = document.getElementByIdNative('falcon-source-explorer-tree-node-openable-10');

            expect(child.data.opened).to.equal(true);
            toggle.click();
          });
        });

        it('should catch _open', function(done) {
          flush(function() {
            falconSourceExplorer.addEventListener('open-falcon-source-explorer-tree-node', (e) => {
              expect(e.detail.data.opened).to.equal(true);
              done();
            });

            const child = document.getElementByIdNative('falcon-source-explorer-tree-node-4');
            toggle = document.getElementByIdNative('falcon-source-explorer-tree-node-openable-4');

            expect(child.data.opened).to.equal(false);
            toggle.click();
          });
        });
      });
    </script>
  </body>
</html>
