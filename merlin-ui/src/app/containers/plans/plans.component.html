<mat-toolbar color="primary">
  <span>Plans</span>
</mat-toolbar>

<as-split [gutterSize]="4">
  <as-split-area [size]="35">
    <app-panel-header>
      Create Plan
    </app-panel-header>
    <div class="p-1">
      <app-placeholder
        *ngIf="adaptations === null"
        [height]="100"
      ></app-placeholder>

      <mat-card *ngIf="adaptations !== null">
        <form [formGroup]="createPlanForm" (ngSubmit)="onSubmit()">
          <div *ngIf="!adaptations.length" id="no-adaptations-message">
            No adaptations found.<br />
            You need an adaptation in order to make a plan.<br />
            Try adding an adaptation
            <a [routerLink]="['/adaptations']">here</a>.
          </div>

          <ng-container *ngIf="adaptations.length">
            <mat-form-field class="w-100" appearance="outline">
              <mat-label>Adaptation</mat-label>
              <mat-select
                formControlName="adaptationId"
                [required]="true"
                [value]="selectedAdaptationId"
              >
                <mat-option
                  *ngFor="let adaptation of adaptations"
                  [value]="adaptation.id"
                >
                  {{ adaptation.name }} {{ adaptation.version }}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="createPlanForm.controls.adaptationId.invalid">
                You must enter an adaptation
              </mat-error>
            </mat-form-field>

            <mat-form-field class="w-100" appearance="outline">
              <mat-label>Name</mat-label>
              <input
                #inputCreatePlanName
                [required]="true"
                autocomplete="off"
                formControlName="name"
                matInput
                type="text"
              />
              <mat-error *ngIf="createPlanForm.controls.name.invalid">
                You must enter a name
              </mat-error>
            </mat-form-field>

            <mat-form-field class="w-100" appearance="outline">
              <mat-label>Start Date</mat-label>
              <input
                [required]="true"
                autocomplete="off"
                formControlName="startTimestamp"
                matInput
                type="text"
              />
              <mat-error *ngIf="createPlanForm.controls.startTimestamp.invalid">
                You must enter a start date/time
              </mat-error>
            </mat-form-field>

            <mat-form-field class="w-100" appearance="outline">
              <mat-label>End Date</mat-label>
              <input
                [required]="true"
                autocomplete="off"
                formControlName="endTimestamp"
                matInput
                type="text"
              />
              <mat-error *ngIf="createPlanForm.controls.endTimestamp.invalid">
                You must enter an end date/time
              </mat-error>
            </mat-form-field>

            <button
              class="mr-2"
              mat-raised-button
              color="accent"
              [disabled]="!createPlanForm.valid"
            >
              Create
            </button>
          </ng-container>
        </form>
      </mat-card>
    </div>
  </as-split-area>

  <as-split-area [size]="65">
    <app-panel-header>
      Plan List
    </app-panel-header>
    <div class="p-1">
      <app-placeholder *ngIf="plans === null"></app-placeholder>
      <ng-container *ngIf="plans !== null">
        <mat-card *ngIf="!plans.length" id="no-plans-message">
          No plans found.
        </mat-card>

        <table
          *ngIf="plans.length"
          [dataSource]="plans"
          id="plans-table"
          mat-table
          class="w-100 mat-elevation-z1"
        >
          <ng-container matColumnDef="menu">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let element">
              <button mat-icon-button [matMenuTriggerFor]="menu">
                <mat-icon>more_vert</mat-icon>
              </button>
              <mat-menu #menu="matMenu">
                <button mat-menu-item (click)="onOpenPlan(element.id)">
                  <span>Open</span>
                </button>
                <button mat-menu-item (click)="onDeletePlan(element.id)">
                  <span>Delete</span>
                </button>
              </mat-menu>
            </td>
          </ng-container>

          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>Plan Name</th>
            <td
              mat-cell
              *matCellDef="let element"
              (click)="onOpenPlan(element.id)"
            >
              {{ element.name }}
            </td>
          </ng-container>

          <ng-container matColumnDef="adaptationId">
            <th mat-header-cell *matHeaderCellDef>Adaptation Id</th>
            <td
              mat-cell
              *matCellDef="let element"
              (click)="onOpenPlan(element.id)"
            >
              {{ element.adaptationId }}
            </td>
          </ng-container>

          <ng-container matColumnDef="startTimestamp">
            <th mat-header-cell *matHeaderCellDef>Start Time</th>
            <td
              mat-cell
              *matCellDef="let element"
              (click)="onOpenPlan(element.id)"
            >
              {{ element.startTimestamp }}
            </td>
          </ng-container>

          <ng-container matColumnDef="endTimestamp">
            <th mat-header-cell *matHeaderCellDef>End Time</th>
            <td
              mat-cell
              *matCellDef="let element"
              (click)="onOpenPlan(element.id)"
            >
              {{ element.endTimestamp }}
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
      </ng-container>
    </div>
  </as-split-area>
</as-split>
